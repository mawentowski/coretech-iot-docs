<div class="title-box">
    <h1 class="topic-title">Troubleshooting Error Codes</h1>
    <div class="action-statement">
        Learn how to troubleshoot based on error codes generated by Flex APIs.
    </div>
</div>
<p>
    Flex APIs follow standard RESTful API status code conventions when it comes
    to error codes. These troubleshooting guidelines are intended to be as
    specific as possible to Flex APIs.
</p>
<h2 id="400-bad-request">400 Bad Request</h2>
<p>The request was invalid.</p>
<h3 id="invalid-request">Invalid Request</h3>
<p>
    Flex returns this error code when some part of the Request URL is invalid,
    excluding a Resource which triggers a
    <code class="inline-code">404: Resource not found</code>. The
    <code class="inline-code">error_description</code> indicates which value was
    incorrect.
</p>
<p>
    In the example below, Flex returned this error after sending a Get Access
    token request and the <code class="inline-code">AAD_tenent</code> passed in
    the Resource URL is invalid. It could be the case that this value was
    incorrectly spelled, for example.
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "error": "invalid_request",
    "error_description": "AADSTS900023: Specified tenant identifier '{{tennt}}' is neither a valid DNS name, nor a valid external domain.\r\nTrace ID: e2f39c31-d6fb-4c66-9c35-a815eeb33300\r\nCorrelation ID: 225c9f55-e2ef-4c24-8619-306a0ce36cbd\r\nTimestamp: 2021-11-05 11:42:40Z",
    "error_codes": [
        900023
    ],
    "timestamp": "2021-11-05 11:42:40Z",
    "trace_id": "e2f39c31-d6fb-4c66-9c35-a815eeb33300",
    "correlation_id": "225c9f55-e2ef-4c24-8619-306a0ce36cbd",
    "error_uri": "https://login.microsoftonline.com/error?code=900023"
}
        </code>
        </pre>
</div>

<p class="caption">
    Response Body when <code class="inline-code">AAD_tenent</code> passed in
    Resource URL is invalid
</p>
<p>
    The resolution is to simply correct the invalid value in the Resource URL,
    then attempt another request.
</p>
<h3 id="one-or-more-validation-errors-occurred">
    One or more validation errors occurred
</h3>
<p>
    A Flex API returns this error in either one of the following scenarios. They
    are somewhat specific to Postman when attempting to pass values as variables
    that may no longer be valid. They occur:
</p>
<ul>
    <li>
        when attempting to connect to, or interact with, a peripheral when a
        <code class="inline-code">session/v2/subscriptions</code> request was
        made unsuccessfully during this session:
    </li>
</ul>
<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
    "title": "One or more validation errors occurred.",
    "status": 400,
    "traceId": "00-68e38c2ba0ec8840a4005dadea0d81c0-32fa28d00f6b3340-00",
    "errors": {
        "$.SubscriptionId": [
            "The JSON value could not be converted to System.Guid. Path: $.SubscriptionId | LineNumber: 1 | BytePositionInLine: 24."
        ]
    }
}
        </code>
        </pre>
</div>

<p class="caption">Response Body when no subscription exists</p>
<ul>
    <li>when the connection to a device has expired:</li>
</ul>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
    "title": "One or more validation errors occurred.",
    "status": 400,
    "traceId": "00-815de99286d3954fa69fce27b1ce06df-819ec6565c1c944a-00",
    "errors": {
        "$.connectionId": [
            "The JSON value could not be converted to System.Guid. Path: $.connectionId | LineNumber: 1 | BytePositionInLine: 20."
        ]
    }
}
        </code>
        </pre>
</div>

<p class="caption">Response Body when connection to device has expired</p>
<ul>
    <li>
        when attempting to delete a connection to a device when at present there
        is no connection.
    </li>
</ul>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
    "title": "One or more validation errors occurred.",
    "status": 400,
    "traceId": "00-ddcc4b696af7fc4e90e1566144750fbb-51c76a2b58fbdd49-00",
    "errors": {
        "connectionId": [
            "The value 'null' is not valid."
        ]
    }
}
        </code>
        </pre>
</div>

<p class="caption">
    Response Body when attempting to delete a connection when it does not exist
</p>
<p>
    To determine which scenario applies, check the
    <code class="inline-code">errors</code> value in the Response Body:
</p>
<ul>
    <li>
        If the error says <code class="inline-code">SubscriptionId</code>, then
        no subscription exists. Simply send a
        <code class="inline-code">session/v2/subscriptions</code> request to
        create and receive details for a new subscription.
    </li>
    <li>
        If the error says <code class="inline-code">connectionId</code> with a
        <code class="inline-code">could not be converted</code> message, then
        the connection to the device has expired. Simply connect to the device
        again.
    </li>
    <li>
        If the error says <code class="inline-code">connectionId</code> with a
        <code class="inline-code">The value 'null' is not valid.</code>
        message, then there is no connection to delete.
    </li>
</ul>
<h3 id="connection-has-expired">Connection has expired</h3>
<p>
    A Flex API returns this error when the connection to a device has expired.
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
    "title": "Bad Request",
    "status": 400,
    "detail": "Connection has expired.",
    "traceId": "00-baf5325b0757fc408018bca88119a826-65e7e75f65b69c4a-00"
}
        </code>
        </pre>
</div>

<p class="caption">The connection to the device has expired</p>
<p>
    After connecting to a device, a connection
    <code class="inline-code">expiryTime</code> is returned in the Response Body
    set to <strong>30 minutes</strong> from the time the
    <code class="inline-code">session/v2/connections</code> request was made.
</p>
<p>
    The resolution is to simply send another
    <code class="inline-code">session/v2/connections</code> request.
</p>
<h3 id="no-connection-exists">No Connection Exists</h3>
<p>
    A Flex API returns this error when the connection to a device has expired.
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
    "title": "Bad Request",
    "status": 400,
    "detail": "No Connection Exists.",
    "traceId": "00-baf5325b0757fc408018bca88119a826-65e7e75f65b69c4a-00"
}  
        </code>
        </pre>
</div>

<p class="caption">The connection to the device has expired</p>
<p>
    After connecting to a device, a connection
    <code class="inline-code">expiryTime</code> is returned in the Response Body
    set to <strong>30 minutes</strong> from the time the
    <code class="inline-code">session/v2/connections</code> request was made.
</p>
<p>
    The resolution is to simply send another
    <code class="inline-code">session/v2/connections</code> request.
</p>
<h2 id="401-unauthorized">401 Unauthorized</h2>
<p>
    The request did not include an authentication token, or the authentication
    token was expired.
</p>
<h3 id="unauthorized">Unauthorized</h3>
<p>
    Flex returns this error when the
    <code class="inline-code">access_token</code> included in the Authorization
    Header of a request has expired.
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://httpstatuses.com/401",
    "title": "Unauthorized",
    "status": 401,
    "traceId": "00-1e8461bd7e3e4448940a7aa2237a2515-9cfcf731cb93354b-00"
}       
        </code>
        </pre>
</div>

<p class="caption">
    Response Body when <code class="inline-code">access_token</code> has expired
</p>
<p>
    After requesting a Get Access Token, the returned
    <code class="inline-code">access_token</code> has an
    <code class="inline-code">expires_in</code> value of
    <code class="inline-code">3599</code> seconds, as indicated in the Response
    Body. This duration of time roughly equals <strong>60 minutes</strong>.
</p>
<p>
    Ensure that you refresh this access token by sending another Get Access
    Token request if continued access is required.
</p>
<p>After refreshing the access token, you must reconnect to devices.</p>
<h2 id="403-forbidden">403 Forbidden</h2>
<p>The client did not have permission to access the requested resource.</p>
<h3 id="forbidden">Forbidden</h3>
<p>
    A Flex API returns this error when your permissions are not sufficient to
    perform the operation. Contact
    <a
        href="mailto:&#102;&#x6c;&#101;&#120;&#46;&#97;&#112;&#105;&#46;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#x73;&#x69;&#x74;&#97;&#x2e;&#97;&#x65;&#114;&#111;"
        >&#102;&#x6c;&#101;&#120;&#46;&#97;&#112;&#105;&#46;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#x73;&#x69;&#x74;&#97;&#x2e;&#97;&#x65;&#114;&#111;</a
    >
    to request permission.
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://httpstatuses.com/403",
    "title": "Forbidden",
    "status": 403,
    "traceId": "00-a0876953d809b243aef112b22fab2139-1d37802bf725bf42-00"
}
        </code>
        </pre>
</div>

<p class="caption">
    Response Body when permissions are insufficient to access the resource
</p>
<h2 id="404-resource-not-found">404 Resource Not Found</h2>
<p>The requested resource was not found.</p>
<h3 id="resource-not-found">Resource not found</h3>
<p>
    A Flex API returns this error when a Flex Resource, also known as an API,
    has been entered incorrectly in the Resource URL.
</p>
<ol>
    <li>
        Verify you are targeting the endpoint below for the Pre-production
        environment that your development environment has been configured in:
        <a href="https://sita-apiprx-eastus-apimanagement.azure-api.net/"
            >https://sita-apiprx-eastus-apimanagement.azure-api.net/</a
        >.
    </li>
    <li>
        Identify and correct any other erroneous information, then attempt
        another request.
    </li>
</ol>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "statusCode": 404,
    "message": "Resource not found"
}
        </code>
        </pre>
</div>

<p class="caption">
    Response Body when an invalid Resource is included in the URL
</p>
<h2 id="500-internal-server-error">500 Internal Server Error</h2>
<p>
    The request was not completed due to an internal error on the server side.
</p>
<h3 id="an-error-has-occurred-while-communicating-with-the-device">
    An error has occurred while communicating with the device
</h3>
<p>
    Any 500 Internal Errors are indicative of a major failure and should be sent
    immediately to
    <a href="mailto:mark.wentowski@techwritex.com"
        >techsupport@techwritex.com</a
    >
</p>

<div class="method-example atom-one-light">
    <div class="method-example-top-bar">Error</div>
    <pre>
            <code class="language-json">
{
    "type": "https://tools.ietf.org/html/rfc7231#section-6.6.1",
    "title": "An error occurred while processing your request.",
    "status": 500,
    "detail": "An error has occurred while communicating with the device.",
    "traceId": "00-986e0e92622762478a360016038a2602-93ae8d22a22c9041-00"
}
        </code>
        </pre>
</div>

<p class="caption">
    Response Body that can occur for many reasons when a major error has been
    encountered
</p>
<h2 id="503-service-unavailable">503 Service Unavailable</h2>
<p>
    Standard error indicating the server is unavailable. Try again at a later.
</p>
