<h2 id="service-bus-messages-3">Service Bus Messages</h2>
<p>
    The following is not an exhaustive list of all possible Service Bus
    <code class="inline-code">Message Types</code>. Only the most common ones
    encountered when sending Bagdrop API requests are described.
</p>
<h3 id="bagdropdevicestatus">BagdropDeviceStatus</h3>
<p>
    A <code class="inline-code">BagdropDeviceStatus</code> message displays on
    the Service Bus:
</p>
<ul>
    <li>
        when the <code class="inline-code">DeviceStatus</code> changes. For
        example, when the SBD goes from
        <code class="inline-code">Online</code> to
        <code class="inline-code">Offline</code>, or vice versa. An SBD may go
        <code class="inline-code">Offline</code> due to an issue with the
        device, or when a
        <code class="inline-code">BagDropTransactionTimeout</code> occurs.
    </li>
    <li>
        after a <code class="inline-code">/bagdrop/v2/getbag</code> request is
        sent, which initiates the bagdrop process and reserves the SBD for
        exclusive access by the airline backend. The
        <code class="inline-code">DeviceInUse</code> property changes from
        <code class="inline-code">false</code> (the value displayed after
        sending the POST
        <code class="inline-code">/session/v2/connections</code> request) to
        <code class="inline-code">true</code>.
    </li>
</ul>
<pre><code class="language-JSON">{
    "DeviceStatus": "Online",
    "DeviceInUse": true
}
</code></pre>
<h5
    id="example-bagdropdevicestatus-service-bus-message-indicating-the-device-is-online-and-exclusively-reserved"
>
    Example <code class="inline-code">BagdropDeviceStatus</code> Service Bus
    Message indicating the device is online and exclusively reserved
</h5>
<h3 id="dooropening-and-doorclosing">DoorOpening and DoorClosing</h3>
<div class="alert-section info-alert">
    <div class="">
        <p>
            These messages only display if the SBD is configured to have a door.
        </p>
    </div>
    <p>
        A <code class="inline-code">DoorOpening</code> message displays on the
        Service Bus:
    </p>
    <ul>
        <li>
            When a <code class="inline-code">/bagdrop/v2/getbag</code> request
            is sent that opens the door to the SBD so the passenger can place
            her bag on the belt.
        </li>
        <li>
            When an issue has occurred and either a
            <code class="inline-code">/bagdrop/v2/returnbag</code> or
            <code class="inline-code">/bagdrop/v2/cancelbag</code> request was
            sent to open the door and return the bag to the
            <code class="inline-code">Entry</code> position so the issue can be
            resolved by the customer or an agent.
        </li>
    </ul>
    <p>
        A <code class="inline-code">DoorClosing</code> message displays on the
        Service Bus:
    </p>
    <ul>
        <li>
            after a
            <code class="inline-code">/bagdrop/v2/processbag</code> request is
            sent. The door to the SBD closes and the bag moves from the
            <code class="inline-code">Entry</code> position to the
            <code class="inline-code">Process</code> position.
        </li>
    </ul>
    <div class="alert-section info-alert">
        <div class="">
            <p>Both messages contain an empty Message Body.</p>
        </div>
        <h3 id="bagplaced">BagPlaced</h3>
        <p>
            After a <code class="inline-code">/bagdrop/v2/getbag</code> request
            initiates the bagdrop process, the door to the SBD opens (if there
            is a door) so the passenger can place the bag on the belt. Baggage
            information may be collected by the SBD and displayed in a
            <code class="inline-code">BagPlaced</code> message on the Service
            Bus.
        </p>
        <pre><code class="language-json">{
    "Bag": {
        "Tags": [],
        "Weight": {
            "Amount": 23.8,
            "Unit": "Kg"
        },
        "Position": "Entry",
        "VolumeResult": {
            "Width": {
                "Amount": 0.0,
                "Unit": "Cm"
            },
            "Height": {
                "Amount": 0.0,
                "Unit": "Cm"
            },
            "Length": {
                "Amount": 0.0,
                "Unit": "Cm"
            },
            "TubDetection": "NoTub"
        }
    },
    "IsSuccess": true,
    "Error": null
}
</code></pre>
        <h5
            id="bagplaced-service-bus-message-displaying-properties-of-the-placed-bag"
        >
            <code class="inline-code">BagPlaced</code> Service Bus message
            displaying properties of the &#39;placed&#39; bag
        </h5>
        <p>
            The
            <code class="inline-code">"Position": "Entry"</code>
            indicates that the bag is currently located on the
            <code class="inline-code">Entry</code> position of the SBD unit.
        </p>
        <p>
            <code class="inline-code">"IsSuccess": true</code>
            indicates that a bag has been placed on the belt, and a settled
            weight has been calculated for the bag, in addition to other
            measurements such as the dimensions of the bag.
        </p>
        <h3 id="bagchanged">BagChanged</h3>
        <p>
            The structure of the
            <code class="inline-code">BagChanged</code> message is identical to
            the <code class="inline-code">BagPlaced</code> message and displays
            baggage information collected through a measurement.
        </p>
        <p>
            The property of importance is
            <code class="inline-code">Position</code>. Whenever a bag moves from
            one position to the next, a
            <code class="inline-code">BagChanged</code> message displays that
            indicates the value of <code class="inline-code">Position</code> has
            changed. For example, when the bag moves from the
            <strong>Entry Area</strong> to the <strong>Process Area</strong>,
            the property <code class="inline-code">Position</code> changes from
            <code class="inline-code">Entry</code> to
            <code class="inline-code">Process</code>. When the bag moves back
            from <code class="inline-code">Process</code> to
            <code class="inline-code">Entry</code>, in the case of an issue,
            this message displays as well.
        </p>
        <p>
            Regarding the baggage information, the following scenarios are
            possible, depending on the configuration of the SBD:
        </p>
        <ul>
            <li>
                The <code class="inline-code">Process</code> position may be the
                first-time baggage information was collected (not the
                <code class="inline-code">Entry</code> position).
            </li>
            <li>
                Baggage information may be collected a second time at the
                <code class="inline-code">Process</code> position, updating the
                values collected at the
                <code class="inline-code">Entry</code> position.
            </li>
            <li>
                Baggage information is not collected at all at the
                <code class="inline-code">Process</code> position. The baggage
                information matches the information collected in the
                <code class="inline-code">Entry</code> position.
            </li>
        </ul>
        <h3 id="bagresponses">BagResponses</h3>
        <div class="alert-section info-alert">
            <div class="">
                <p>
                    For this documentation, Service Bus
                    <code class="inline-code">MessageTypes</code> that contain
                    the text <code class="inline-code">BagResponse</code> are
                    grouped together since they all simply confirm the success
                    or failure of a request. In actuality, the
                    <code class="inline-code">MessageTypes</code> will be
                    specific to the type of request that was sent. For example,
                    after a
                    <code class="inline-code">/bagdrop/v2/getbag</code> request
                    is sent, a
                    <code class="inline-code">GetBagResponse</code> response
                    displays on the Service Bus.
                </p>
            </div>
            <p>
                <code class="inline-code">BagResponse</code> messages display on
                the Service Bus after sending requests to the BagDrop API at
                different stages of a bagdrop process and are often sent in
                conjunction with other types of messages such as a
                <code class="inline-code">BagChanged</code> and
                <code class="inline-code">BagdropDeviceStatus</code> message.
            </p>
            <p>
                The only purpose of a
                <code class="inline-code">BagResponse</code> message is to
                indicate whether the request was successful (
                <code class="inline-code">"IsSuccess": true</code>). The
                structure of
                <code class="inline-code">BagResponse</code> messages are
                identical to the <code class="inline-code">BagPlaced</code> and
                <code class="inline-code">BagChanged</code> messages that
                display collected baggage information.
            </p>
            <p>
                The following
                <code class="inline-code">BagResponse</code> messages display on
                the Service Bus by endpoint:
            </p>
            <ul>
                <li>
                    A <code class="inline-code">GetBagResponse</code> is
                    received after a
                    <code class="inline-code">/bagdrop/v2/getbag</code> request
                    is sent to initiate the bag drop process and open the SBD
                    door if there is one.
                </li>
            </ul>
            <p>
                If the SBD has a door, the property
                <code class="inline-code">"Bag": null</code> is returned which
                indicates no baggage information was collected because a bag has
                not been placed on the belt yet.
            </p>
            <p>
                If the SBD does not have a door, the
                <code class="inline-code">GetBagResponse</code> message includes
                the baggage information collected from the bag placed on the
                belt at the time the
                <code class="inline-code">/bagdrop/v2/getbag</code> request was
                sent.
            </p>
            <ul>
                <li>
                    <p>
                        A <code class="inline-code">ProcessBagResponse</code> is
                        received after a
                        <code class="inline-code">/bagdrop/v2/processbag</code>
                        request is sent to move the bag from the
                        <code class="inline-code">Entry</code> position to the
                        <code class="inline-code">Process</code> position where
                        the bag can be processed.
                    </p>
                </li>
                <li>
                    <p>
                        A <code class="inline-code">ReturnBagResponse</code> is
                        received after a
                        <code class="inline-code">/bagdrop/v2/returnbag</code>
                        request is sent to return the bag to the
                        <code class="inline-code">Entry</code> position
                        <em>where the passenger</em> can resolve an issue.
                    </p>
                </li>
                <li>
                    <p>
                        A <code class="inline-code">CancelBagResponse</code> is
                        received after a
                        <code class="inline-code">/bagdrop/v2/cancelbag</code>
                        request is sent to return the bag to the
                        <code class="inline-code">Entry</code> position
                        <em>where the agent</em> can resolve an issue.
                    </p>
                </li>
                <li>
                    <p>
                        A <code class="inline-code">ReleaseBagResponse</code> is
                        received after a
                        <code class="inline-code">/bagdrop/v2/releasebag</code>
                        request is sent to release the bag to the Baggage
                        Handling System (BHS Area).
                    </p>
                </li>
            </ul>
            <h4 id="errorcodes">ErrorCodes</h4>
            <p>
                If a request fails, the Service Bus message will return no
                baggage information with an
                <code class="inline-code">ErrorCode</code> and
                <code class="inline-code">Message</code> describing why the
                request failed. A possible cause is there was a
                <code class="inline-code">BagDropTransactionTimeout</code> that
                prevents sending any further requests to the SBD.
            </p>
            <pre><code class="language-JSON">{
   "Bag":null,
   "IsSuccess":false,
   "Error":{
      "ErrorCode":"UnknownError",
      "Message":"ReturnBag failed, device status: . Bag cannot be Returned."
   }
}
</code></pre>
            <h5
                id="sample-returnbagresponse-message-indicating-the-reason-the-request-failed"
            >
                Sample
                <code class="inline-code">ReturnBagResponse</code> Message
                indicating the reason the request failed
            </h5>
            <h3 id="bagdroptransactiontimeout">BagDropTransactionTimeout</h3>
            <p>
                A
                <code class="inline-code">BagDropTransactionTimeout</code>
                message displays on the Service Bus with an empty Message Body
                when too much time has elapsed since the last Bagdrop API
                request was made.
            </p>
            <h4 id="timeout-at-entry-area">Timeout at Entry Area</h4>
            <p>
                If this error occurs when the bag is in the
                <code class="inline-code">Entry</code> position, another
                <code class="inline-code">/bagdrop/v2/getbag</code> request must
                be made to restart the bagdrop process. If you send a
                <code class="inline-code">/bagdrop/v2/processbag</code> request
                when a timeout has occurred, and you have not sent the
                <code class="inline-code">/bagdrop/v2/getbag</code> request, you
                will receive an error status code.
            </p>
            <h4 id="timeout-at-process-area">Timeout at Process Area</h4>
            <p>
                If this error occurs when the bag is in the
                <code class="inline-code">Process</code> position, a
                <code class="inline-code">BagdropDeviceStatus</code> message
                also displays on the Service Bus indicating the device is no
                longer &#39;in use&#39; (<code>"DeviceInUse": false</code>).
            </p>
            <p>
                You will receive an error status code when sending any further
                requests. For example, if you attempt to send a
                <code class="inline-code">/bagdrop/v2/releasebag</code> request
                to continue to the next phase in the bagdrop process, you will
                receive an error.
            </p>
            <p>
                At this stage, sending another
                <code class="inline-code">/bagdrop/v2/getbag</code> request to
                restart the bag drop process will not resolve the issue because
                there is a bag located in the
                <code class="inline-code">Process</code> position that requires
                action. The process cannot be restarted until the bag is
                removed.
            </p>
        </div>
    </div>
</div>
